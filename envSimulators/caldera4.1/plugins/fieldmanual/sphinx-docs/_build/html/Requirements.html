

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Requirements &mdash; caldera  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Objectives" href="Objectives.html" />
    <link rel="prev" title="Relationships" href="Relationships.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/caldera-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Usage Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installing-CALDERA.html">Installing CALDERA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Learning-the-terminology.html">Learning the terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basic-Usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Server-Configuration.html">Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Plugin-library.html">Plugin library</a></li>
<li class="toctree-l1"><a class="reference internal" href="Parsers.html">Parsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Relationships.html">Relationships</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Objectives.html">Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="Operation-Results.html">Operation Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="Initial-Access-Attacks.html">Initial Access Attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lateral-Movement-Guide.html">Windows Lateral Movement Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dynamically-Compiled-Payloads.html">Dynamically-Compiled Payloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exfiltration.html">Exfiltration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sandcat-Peer-to-Peer.html">Peer-to-Peer Proxy Functionality for Sandcat Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="C2-Tunneling.html">C2 Communications Tunneling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Uninstalling-CALDERA.html">Uninstall CALDERA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plugin Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plugins/sandcat/Sandcat-Details.html">Sandcat Plugin Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins/stockpile/Exfiltration-How-Tos.html">Exfiltration Scenarios and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins/stockpile/Exfiltration-How-Tos.html#an-example">An Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins/stockpile/Exfiltration-How-Tos.html#wrap-up">Wrap-up</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="The-REST-API.html">The REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to-Build-Plugins.html">How to Build Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to-Build-Planners.html">How to Build Planners</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to-Build-Agents.html">How to Build Agents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core System API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_generated/modules.html">app</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caldera</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Requirements</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Requirements.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="requirements">
<h1>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">¶</a></h1>
<p>Requirements are a mechanism used by CALDERA to determine whether an ability should be run in the course of an
operation. By default, CALDERA supplies several requirements <a class="reference external" href="https://github.com/mitre/stockpile/tree/master/app/requirements">within the Stockpile plugin</a>
that can be used by an ability to ensure the ability only runs when the facts being used by the ability command meet
certain criteria.</p>
<p>Requirements are defined in a Python module and are then referenced inside an ability. All requirements must be provided
at least a <code class="docutils literal notranslate"><span class="pre">source</span></code> fact to enforce the defined requirement on. Depending on the requirement module, a requirement
module may also need an <code class="docutils literal notranslate"><span class="pre">edge</span></code> value and a <code class="docutils literal notranslate"><span class="pre">target</span></code> fact to be provided as arguments to enforce the defined requirement.</p>
<p>See <a class="reference internal" href="Relationships.html"><span class="doc std std-doc">Relationships</span></a> for more information on relationship <code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">edge</span></code>, and <code class="docutils literal notranslate"><span class="pre">target</span></code> values.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>Let’s look at the <strong>Impersonate User</strong> ability from Stockpile as an example.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3796a00b-b11d-4731-b4ca-275a07d83299</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Impersonate user</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run an application as a different user</span>
<span class="w">  </span><span class="nt">tactic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">execution</span>
<span class="w">  </span><span class="nt">technique</span><span class="p">:</span>
<span class="w">    </span><span class="nt">attack_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">T1059.001</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Command</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">Scripting</span><span class="nv"> </span><span class="s">Interpreter:</span><span class="nv"> </span><span class="s">PowerShell&quot;</span>
<span class="w">  </span><span class="nt">platforms</span><span class="p">:</span>
<span class="w">    </span><span class="nt">windows</span><span class="p">:</span>
<span class="w">      </span><span class="nt">psh</span><span class="p">:</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">$job = Start-Job -ScriptBlock {</span>
<span class="w">            </span><span class="no">$username = &#39;#{host.user.name}&#39;;</span>
<span class="w">            </span><span class="no">$password = &#39;#{host.user.password}&#39;;</span>
<span class="w">            </span><span class="no">$securePassword = ConvertTo-SecureString $password -AsPlainText -Force;</span>
<span class="w">            </span><span class="no">$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword;</span>
<span class="w">            </span><span class="no">Start-Process Notepad.exe -NoNewWindow -PassThru -Credential $credential;</span>
<span class="w">          </span><span class="no">};</span>
<span class="w">          </span><span class="no">Receive-Job -Job $job -Wait;</span>
<span class="w">  </span><span class="nt">requirements</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">plugins.stockpile.app.requirements.paw_provenance</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host.user.name</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">plugins.stockpile.app.requirements.basic</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host.user.name</span>
<span class="w">        </span><span class="nt">edge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">has_password</span>
<span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host.user.password</span>
</pre></div>
</div>
<p>Notice in the ability command, two facts <code class="docutils literal notranslate"><span class="pre">host.user.name</span></code> and <code class="docutils literal notranslate"><span class="pre">host.user.password</span></code> will be used. The <code class="docutils literal notranslate"><span class="pre">paw_provenance</span></code>
requirement enforces that only <code class="docutils literal notranslate"><span class="pre">host.user.name</span></code> facts that were discovered by the agent running the ability can be used
(i.e. fact originated from the same <code class="docutils literal notranslate"><span class="pre">paw</span></code>). In the scenario this ability is run against two agents on two different
hosts where multiple <code class="docutils literal notranslate"><span class="pre">host.user.name</span></code> and <code class="docutils literal notranslate"><span class="pre">host.user.password</span></code> facts were discovered, the <code class="docutils literal notranslate"><span class="pre">paw_provenance</span></code> prevents
facts discovered by the first agent on the first host from being used by the second agent on the second host. This
ensures facts discovered locally on one host are only used on the host where those facts would apply, such as in the
scenario the <code class="docutils literal notranslate"><span class="pre">host.user.name</span></code> is a local account that only exists on the host it was discovered on. Other possible
usages could apply the <code class="docutils literal notranslate"><span class="pre">paw_provenance</span></code> requirement to files discovered, file paths, and running processes, all of
which would be discovered information that should only be used by the host they were discovered on and not globally by
other agents running on other hosts in an operation.</p>
<p>Additionally, the <code class="docutils literal notranslate"><span class="pre">basic</span></code> requirement enforces that only <code class="docutils literal notranslate"><span class="pre">host.user.name</span></code> facts with an existing <code class="docutils literal notranslate"><span class="pre">has_password</span></code>
relationship to an existing <code class="docutils literal notranslate"><span class="pre">host.user.password</span></code> fact may be used. Brute forcing all available combinations of
<code class="docutils literal notranslate"><span class="pre">host.user.name</span></code> facts and <code class="docutils literal notranslate"><span class="pre">host.user.password</span></code> facts could result in high numbers of failed login attempts or locking
out an account entirely. The <code class="docutils literal notranslate"><span class="pre">basic</span></code> requirement ensures that the user and password combination used has a high chance
of success since the combination’s relationship has already been established by a previous ability.</p>
<p>The combined effect these requirements have ensures that the CALDERA operation will only attempt reliable combinations
of <code class="docutils literal notranslate"><span class="pre">host.user.name</span></code> and <code class="docutils literal notranslate"><span class="pre">host.user.password</span></code> facts specific to the agent running the ability, instead of arbitrarily
attempting all possible combinations of <code class="docutils literal notranslate"><span class="pre">host.user.name</span></code> and <code class="docutils literal notranslate"><span class="pre">host.user.password</span></code> facts available to the agent.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Objectives.html" class="btn btn-neutral float-right" title="Objectives" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Relationships.html" class="btn btn-neutral float-left" title="Relationships" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, The MITRE Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>