

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Relationships &mdash; caldera  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Requirements" href="Requirements.html" />
    <link rel="prev" title="Parsers" href="Parsers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/caldera-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Usage Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installing-CALDERA.html">Installing CALDERA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Learning-the-terminology.html">Learning the terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basic-Usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Server-Configuration.html">Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Plugin-library.html">Plugin library</a></li>
<li class="toctree-l1"><a class="reference internal" href="Parsers.html">Parsers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Relationships</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-relationships-using-abilities">Creating Relationships using Abilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-instances-of-a-fact">Multiple Instances of a Fact</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-components">Optional Components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-relationships-using-caldera-server">Creating Relationships using CALDERA Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="Objectives.html">Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="Operation-Results.html">Operation Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="Initial-Access-Attacks.html">Initial Access Attacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lateral-Movement-Guide.html">Windows Lateral Movement Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dynamically-Compiled-Payloads.html">Dynamically-Compiled Payloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exfiltration.html">Exfiltration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sandcat-Peer-to-Peer.html">Peer-to-Peer Proxy Functionality for Sandcat Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="C2-Tunneling.html">C2 Communications Tunneling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Uninstalling-CALDERA.html">Uninstall CALDERA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plugin Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plugins/sandcat/Sandcat-Details.html">Sandcat Plugin Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins/stockpile/Exfiltration-How-Tos.html">Exfiltration Scenarios and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins/stockpile/Exfiltration-How-Tos.html#an-example">An Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins/stockpile/Exfiltration-How-Tos.html#wrap-up">Wrap-up</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="The-REST-API.html">The REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to-Build-Plugins.html">How to Build Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to-Build-Planners.html">How to Build Planners</a></li>
<li class="toctree-l1"><a class="reference internal" href="How-to-Build-Agents.html">How to Build Agents</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core System API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_generated/modules.html">app</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">caldera</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Relationships</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Relationships.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="relationships">
<h1>Relationships<a class="headerlink" href="#relationships" title="Permalink to this heading">¶</a></h1>
<p>Many CALDERA abilities require input variables called “facts” to be provided before the ability can be run. These facts can be provided through fact sources, or they can be discovered by a previous ability.</p>
<div class="section" id="creating-relationships-using-abilities">
<h2>Creating Relationships using Abilities<a class="headerlink" href="#creating-relationships-using-abilities" title="Permalink to this heading">¶</a></h2>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h3>
<p>As an example, the following printer discovery ability will create two facts called <code class="docutils literal notranslate"><span class="pre">host.print.file</span></code> and <code class="docutils literal notranslate"><span class="pre">host.print.size</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6c91884e-11ec-422f-a6ed-e76774b0daac</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">View printer queue</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">View details of queued documents in printer queue</span>
<span class="w">  </span><span class="nt">tactic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discovery</span>
<span class="w">  </span><span class="nt">technique</span><span class="p">:</span>
<span class="w">    </span><span class="nt">attack_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">T1120</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Peripheral Device Discovery</span>
<span class="w">  </span><span class="nt">platforms</span><span class="p">:</span>
<span class="w">    </span><span class="nt">darwin</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sh</span><span class="p">:</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lpq -a</span>
<span class="w">        </span><span class="nt">parsers</span><span class="p">:</span>
<span class="w">          </span><span class="nt">plugins.stockpile.app.parsers.printer_queue</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host.print.file</span>
<span class="w">            </span><span class="nt">edge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">has_size</span>
<span class="w">            </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host.print.size</span>
</pre></div>
</div>
<p>This ability will view the printer queue using the command <code class="docutils literal notranslate"><span class="pre">lpq</span> <span class="pre">-a</span></code>. The result of <code class="docutils literal notranslate"><span class="pre">lpq</span> <span class="pre">-a</span></code> will be parsed into two facts: <code class="docutils literal notranslate"><span class="pre">host.print.file</span></code> (the <code class="docutils literal notranslate"><span class="pre">source</span></code>) and <code class="docutils literal notranslate"><span class="pre">host.print.size</span></code> (the <code class="docutils literal notranslate"><span class="pre">target</span></code>). These two facts are dependent on each other, and it will be helpful to understand their connection in order to use them. Therefore, we use the <code class="docutils literal notranslate"><span class="pre">edge</span></code> variable to explain the relationship between the <code class="docutils literal notranslate"><span class="pre">source</span></code> and the <code class="docutils literal notranslate"><span class="pre">target</span></code>. In this case, the <code class="docutils literal notranslate"><span class="pre">edge</span></code> is <code class="docutils literal notranslate"><span class="pre">has_size</span></code>, because <code class="docutils literal notranslate"><span class="pre">host.print.size</span></code> is the file size of <code class="docutils literal notranslate"><span class="pre">host.print.file</span></code>. All together, the <code class="docutils literal notranslate"><span class="pre">source</span></code>, <code class="docutils literal notranslate"><span class="pre">edge</span></code>, and <code class="docutils literal notranslate"><span class="pre">target</span></code> comprise a “relationship”. To learn more about how the parser file creates a relationship, refer to <a class="reference internal" href="Parsers.html"><span class="doc std std-doc">Parsers</span></a>.</p>
</div>
<div class="section" id="multiple-instances-of-a-fact">
<h3>Multiple Instances of a Fact<a class="headerlink" href="#multiple-instances-of-a-fact" title="Permalink to this heading">¶</a></h3>
<p>Storing the relationship between the <code class="docutils literal notranslate"><span class="pre">source</span></code> and the <code class="docutils literal notranslate"><span class="pre">target</span></code> in the <code class="docutils literal notranslate"><span class="pre">edge</span></code> allows CALDERA to save several instances of each fact while maintaining the connection between facts. For example, if the printer discovery ability (shown above) is run, and several files are discovered in the printer queue, the following facts may be created.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>host.print.file</p></th>
<th class="head"><p>host.print.size (bytes)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>essay.docx</p></td>
<td><p>12288</p></td>
</tr>
<tr class="row-odd"><td><p>image-1.png</p></td>
<td><p>635000</p></td>
</tr>
<tr class="row-even"><td><p>Flier.pdf</p></td>
<td><p>85300</p></td>
</tr>
</tbody>
</table>
<p>The table above shows how each <code class="docutils literal notranslate"><span class="pre">host.print.file</span></code> value is associated with exactly one <code class="docutils literal notranslate"><span class="pre">host.print.size</span></code> value. This demonstrates the importance of the <code class="docutils literal notranslate"><span class="pre">edge</span></code>; it maintains the association between each pair of <code class="docutils literal notranslate"><span class="pre">source</span></code> and <code class="docutils literal notranslate"><span class="pre">target</span></code> values. Without the <code class="docutils literal notranslate"><span class="pre">edge</span></code>, we would just have a list of values but no information about their relationships, similar to the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">host.print.file</span></code>: <code class="docutils literal notranslate"><span class="pre">essay.docx</span></code>, <code class="docutils literal notranslate"><span class="pre">image-1.png</span></code>, <code class="docutils literal notranslate"><span class="pre">Flier.pdf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host.print.size</span></code>: <code class="docutils literal notranslate"><span class="pre">12288</span></code>, <code class="docutils literal notranslate"><span class="pre">635000</span></code>, <code class="docutils literal notranslate"><span class="pre">85300</span></code></p></li>
</ul>
</div>
<div class="section" id="optional-components">
<h3>Optional Components<a class="headerlink" href="#optional-components" title="Permalink to this heading">¶</a></h3>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">edge</span></code> and the <code class="docutils literal notranslate"><span class="pre">target</span></code> are optional. You can create a <code class="docutils literal notranslate"><span class="pre">source</span></code> as an independent fact without needing to connect it to a <code class="docutils literal notranslate"><span class="pre">target</span></code>.</p>
</div>
</div>
<div class="section" id="creating-relationships-using-caldera-server">
<h2>Creating Relationships using CALDERA Server<a class="headerlink" href="#creating-relationships-using-caldera-server" title="Permalink to this heading">¶</a></h2>
<p>Relationships can also be created in the CALDERA Server GUI. Use the left sidebar to navigate to “fact sources.” Then, click “relationships” followed by “new relationship.” You can fill in  values for the <code class="docutils literal notranslate"><span class="pre">edge</span></code>, <code class="docutils literal notranslate"><span class="pre">source</span></code>, and <code class="docutils literal notranslate"><span class="pre">target</span></code> to be used in future operations. Then click “Save” to finish!</p>
<p><img alt="fact relationships" src="_images/fact_relationships.png" /></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Requirements.html" class="btn btn-neutral float-right" title="Requirements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Parsers.html" class="btn btn-neutral float-left" title="Parsers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, The MITRE Corporation

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>